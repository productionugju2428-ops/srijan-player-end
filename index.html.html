<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Interface - Market Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        .team-select {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
        }
        .team-select h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .team-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .team-btn {
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
            color: white;
            font-weight: bold;
        }
        .team-btn:hover {
            transform: scale(1.05);
        }
        .team-btn:nth-child(1) { background: #e74c3c; }
        .team-btn:nth-child(2) { background: #3498db; }
        .team-btn:nth-child(3) { background: #2ecc71; }
        .team-btn:nth-child(4) { background: #f39c12; }
        .team-btn:nth-child(5) { background: #9b59b6; }
        
        .game-interface {
            display: none;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .timer {
            font-size: 48px;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin: 10px 0;
        }
        .phase {
            text-align: center;
            font-size: 18px;
            color: #666;
            font-weight: bold;
        }
        .auto-save {
            text-align: center;
            font-size: 14px;
            color: #2ecc71;
            margin-top: 5px;
        }
        .event-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .event-box h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        .event-box p {
            color: #856404;
            font-size: 16px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }
        .stat-card .subvalue {
            font-size: 14px;
            color: #999;
            margin-top: 5px;
        }
        .decisions {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .decisions h2 {
            color: #333;
            margin-bottom: 20px;
        }
        .decision-group {
            margin-bottom: 25px;
        }
        .decision-group label {
            display: block;
            color: #555;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .decision-group select,
        .decision-group input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: border-color 0.3s;
        }
        .decision-group select:focus,
        .decision-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        .supplier-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }
        .quality-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
        }
        .quality-high {
            background: #d4edda;
            color: #155724;
        }
        .quality-medium {
            background: #fff3cd;
            color: #856404;
        }
        .quality-low {
            background: #f8d7da;
            color: #721c24;
        }
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        .inventory-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        .inventory-item .label {
            font-size: 12px;
            color: #666;
        }
        .inventory-item .amount {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="teamSelect" class="team-select">
            <h1>üè¢ Market Simulation Game</h1>
            <p style="color: #666; margin: 20px 0;">Select Your Team</p>
            <div class="team-buttons">
                <button class="team-btn" onclick="selectTeam('team1')">Company 1</button>
                <button class="team-btn" onclick="selectTeam('team2')">Company 2</button>
                <button class="team-btn" onclick="selectTeam('team3')">Company 3</button>
                <button class="team-btn" onclick="selectTeam('team4')">Company 4</button>
                <button class="team-btn" onclick="selectTeam('team5')">Company 5</button>
            </div>
        </div>

        <div id="gameInterface" class="game-interface">
            <div class="header">
                <h1 id="teamName">Company 1</h1>
                <div class="timer" id="timer">--</div>
                <div class="phase" id="phase">WAITING FOR GAME TO START</div>
                <div class="auto-save">‚úì Changes auto-saved</div>
            </div>

            <div class="event-box" id="eventBox">
                <h3>üì¢ Current Event</h3>
                <p id="eventText">Game starting soon...</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Market Share</h3>
                    <div class="value" id="marketShare">20%</div>
                </div>
                <div class="stat-card">
                    <h3>Cash</h3>
                    <div class="value" id="cash">‚Çπ10,000</div>
                </div>
                <div class="stat-card">
                    <h3>Products</h3>
                    <div class="value" id="products">0</div>
                </div>
                <div class="stat-card">
                    <h3>Revenue</h3>
                    <div class="value" id="revenue">‚Çπ0</div>
                </div>
            </div>

            <div class="stat-card" style="margin-bottom: 20px;">
                <h3>Inventory</h3>
                <div class="inventory-grid">
                    <div class="inventory-item">
                        <div class="label">Material A</div>
                        <div class="amount" id="matA">50</div>
                    </div>
                    <div class="inventory-item">
                        <div class="label">Material B</div>
                        <div class="amount" id="matB">50</div>
                    </div>
                    <div class="inventory-item">
                        <div class="label">Material C</div>
                        <div class="amount" id="matC">50</div>
                    </div>
                    <div class="inventory-item">
                        <div class="label">Products</div>
                        <div class="amount" id="matProducts">0</div>
                    </div>
                </div>
            </div>

            <div class="decisions">
                <h2>üìä Make Your Decisions</h2>
                
                <div class="decision-group">
                    <label>Selling Price (‚Çπ)</label>
                    <input type="number" id="priceInput" min="1" value="100" step="5">
                </div>

                <div class="decision-group">
                    <label>Select Supplier</label>
                    <select id="supplierSelect"></select>
                    <div class="supplier-info" id="supplierInfo">
                        Cost per product (2A+1B+1C): ‚Çπ--
                    </div>
                </div>

                <div class="decision-group">
                    <label>Production Amount (units)</label>
                    <input type="number" id="productionInput" min="0" value="10" step="1">
                    <div class="supplier-info" id="productionInfo">
                        Will use: --A, --B, --C | Total cost: ‚Çπ--
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAD2qUUaXrDcsjmQc1alsj5UWBWnJN3QRg",
            authDomain: "srijanevent-5a734.firebaseapp.com",
            databaseURL: "https://srijanevent-5a734-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "srijanevent-5a734",
            storageBucket: "srijanevent-5a734.firebasestorage.app",
            messagingSenderId: "967665362410",
            appId: "1:967665362410:web:9be67564a58097f36b7e93"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let currentTeam = null;
        let suppliers = {};
        let autoSaveTimeout = null;

        window.selectTeam = function(teamId) {
            currentTeam = teamId;
            document.getElementById('teamSelect').style.display = 'none';
            document.getElementById('gameInterface').style.display = 'block';
            
            const teamRef = ref(database, `teams/${teamId}`);
            onValue(teamRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    updateUI(data);
                }
            });

            const suppliersRef = ref(database, 'suppliers');
            onValue(suppliersRef, (snapshot) => {
                suppliers = snapshot.val();
                populateSupplierDropdown();
                updateSupplierInfo();
            });

            const gameRef = ref(database, 'gameState');
            onValue(gameRef, (snapshot) => {
                const gameState = snapshot.val();
                if (gameState) {
                    if (gameState.currentEvent) {
                        document.getElementById('eventText').textContent = gameState.currentEvent;
                    }
                    if (gameState.timeRemaining !== undefined) {
                        document.getElementById('timer').textContent = gameState.timeRemaining;
                    }
                }
            });
        };

        function populateSupplierDropdown() {
            const select = document.getElementById('supplierSelect');
            select.innerHTML = '';
            
            Object.keys(suppliers).forEach(supplierId => {
                const s = suppliers[supplierId];
                const option = document.createElement('option');
                option.value = supplierId;
                
                let qualityBadge = '';
                let qualityClass = '';
                if (s.quality >= 80) {
                    qualityBadge = '‚≠ê High';
                    qualityClass = 'quality-high';
                } else if (s.quality >= 60) {
                    qualityBadge = '‚óê Medium';
                    qualityClass = 'quality-medium';
                } else {
                    qualityBadge = '‚óØ Low';
                    qualityClass = 'quality-low';
                }
                
                const costPerProduct = (2 * s.priceA) + s.priceB + s.priceC;
                option.textContent = `${s.name} - ‚Çπ${costPerProduct}/unit - Quality: ${s.quality}% (${qualityBadge})`;
                select.appendChild(option);
            });
        }

        function updateUI(teamData) {
            document.getElementById('teamName').textContent = teamData.name;
            document.getElementById('marketShare').textContent = teamData.marketShare.toFixed(1) + '%';
            document.getElementById('cash').textContent = '‚Çπ' + teamData.cash.toLocaleString();
            document.getElementById('products').textContent = teamData.inventory.finalProduct;
            document.getElementById('revenue').textContent = '‚Çπ' + teamData.stats.totalRevenue.toLocaleString();
            
            document.getElementById('matA').textContent = teamData.inventory.materialA;
            document.getElementById('matB').textContent = teamData.inventory.materialB;
            document.getElementById('matC').textContent = teamData.inventory.materialC;
            document.getElementById('matProducts').textContent = teamData.inventory.finalProduct;

            document.getElementById('priceInput').value = teamData.decisions.sellingPrice;
            document.getElementById('supplierSelect').value = teamData.decisions.selectedSupplier;
            document.getElementById('productionInput').value = teamData.decisions.productionAmount;
        }

        function updateSupplierInfo() {
            const selectedSupplier = document.getElementById('supplierSelect').value;
            if (suppliers[selectedSupplier]) {
                const s = suppliers[selectedSupplier];
                const costPerProduct = (2 * s.priceA) + s.priceB + s.priceC;
                document.getElementById('supplierInfo').innerHTML = 
                    `Cost per product (2A+1B+1C): ‚Çπ${costPerProduct} | Quality: ${s.quality}%`;
                updateProductionInfo();
            }
        }

        function updateProductionInfo() {
            const production = parseInt(document.getElementById('productionInput').value) || 0;
            const selectedSupplier = document.getElementById('supplierSelect').value;
            
            if (suppliers[selectedSupplier]) {
                const s = suppliers[selectedSupplier];
                const costPerProduct = (2 * s.priceA) + s.priceB + s.priceC;
                const totalCost = production * costPerProduct;
                
                document.getElementById('productionInfo').textContent = 
                    `Will use: ${production*2}A, ${production}B, ${production}C | Total cost: ‚Çπ${totalCost}`;
            }
        }

        function autoSaveDecisions() {
            if (!currentTeam) return;

            const price = parseInt(document.getElementById('priceInput').value);
            const supplier = document.getElementById('supplierSelect').value;
            const production = parseInt(document.getElementById('productionInput').value);

            const updates = {};
            updates[`teams/${currentTeam}/decisions/sellingPrice`] = price;
            updates[`teams/${currentTeam}/decisions/selectedSupplier`] = supplier;
            updates[`teams/${currentTeam}/decisions/productionAmount`] = production;

            update(ref(database), updates);
        }

        document.getElementById('supplierSelect').addEventListener('change', () => {
            updateSupplierInfo();
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(autoSaveDecisions, 500);
        });
        
        document.getElementById('priceInput').addEventListener('input', () => {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(autoSaveDecisions, 500);
        });
        
        document.getElementById('productionInput').addEventListener('input', () => {
            updateProductionInfo();
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(autoSaveDecisions, 500);
        });
    </script>
</body>
</html>